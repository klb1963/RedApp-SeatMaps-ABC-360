"use strict";var __extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function __(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(__.prototype=a.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),react_bootstrap_1=require("react-bootstrap"),Context_1=require("./Context"),LayerService_1=require("sabre-ngv-core/services/LayerService"),ISoapApiService_1=require("sabre-ngv-communication/interfaces/ISoapApiService"),PnrPublicService_1=require("sabre-ngv-app/app/services/impl/PnrPublicService"),CreatePNR=function(e){function CreatePNR(t){var a=e.call(this,t)||this;return a.handleChange=a.handleChange.bind(a),a.executeService=a.executeService.bind(a),a.closeAndRefresh=a.closeAndRefresh.bind(a),a.goBack=a.goBack.bind(a),a.goNext=a.goNext.bind(a),a.state={stage:1,traveler:{name:"",surname:"",typeCode:"ADT"},validation:{txtName:{isValid:!1,status:null,helpMsg:null},txtSurname:{isValid:!1,status:null,helpMsg:null},txtEmail:{isValid:!1,status:null,helpMsg:null}}},a}return __extends(CreatePNR,e),CreatePNR.prototype.handleChange=function(e){var t=e.target.id,a=e.target.value,r=this.state.validation,l=this.state.traveler,o=this.state.travelType;if(console.log("handleChange",t,a),"txtName"===t||"txtSurname"===t){var n=r[t],c=a.length;"txtName"===t&&(l.name=a),"txtSurname"===t&&(l.surname=a),c<=0?(n.isValid=!1,n.status="error",n.helpMsg="required field"):c<=1?(n.isValid=!1,n.status="warning",n.helpMsg="must be more than one character long"):c>1&&(n.isValid=!0,n.status="success",n.helpMsg=null)}"selAgeCode"===t&&(l.typeCode=a),"selTravelType"===t&&(o=a),this.setState({traveler:l,travelType:o,validation:r})},CreatePNR.prototype.goNext=function(e){var t=this.state.stage;this.setState({stage:t+1})},CreatePNR.prototype.goBack=function(e){this.setState({stage:1})},CreatePNR.prototype.executeService=function(){var e=this,t=Context_1.getService(ISoapApiService_1.ISoapApiService),a='\n        <UpdateReservationRQ Version="1.19.8" xmlns="http://webservices.sabre.com/pnrbuilder/v1_19">\n        <RequestType commitTransaction="false" initialIgnore="true">Stateful</RequestType>\n        <ReturnOptions IncludeUpdateDetails="true" RetrievePNR="false"/>\n            <ReservationUpdateList>\n                <ReservationUpdateItem>\n                    <PassengerNameUpdate op="C">\n                        <TravelerName type="'+this.state.traveler.typeCode+'">\n                            <Given>'+this.state.traveler.name+"</Given>\n                            <Surname>"+this.state.traveler.surname+'</Surname>\n                        </TravelerName>\n                    </PassengerNameUpdate>\n                </ReservationUpdateItem>\n                <ReservationUpdateItem>\n                    <RemarkUpdate op="C">\n                        <RemarkText>THIS IS '+this.state.travelType+" TRAVEL TYPE REMARK</RemarkText>\n                    </RemarkUpdate>\n                </ReservationUpdateItem>\n            </ReservationUpdateList>\n        </UpdateReservationRQ>\n        ";t.callSws({action:"UpdateReservationRQ",payload:a,authTokenType:"SESSION"}).then(function(t){console.log("Soap API call result",JSON.stringify(t)),t.errorCode||t.value&&t.value.indexOf("<stl19:Error")>=0?e.setState({stage:4}):e.setState({stage:3})}).catch(function(t){console.log("Soap API call error",t),e.setState({stage:4})})},CreatePNR.prototype.handleModalClose=function(){Context_1.getService(LayerService_1.LayerService).clearLayer(42)},CreatePNR.prototype.closeAndRefresh=function(){Context_1.getService(PnrPublicService_1.PnrPublicService).refreshData(),this.handleModalClose()},CreatePNR.prototype.render=function(){var e=this;switch(this.state.stage){case 1:var t=this.state.validation.txtName,a=this.state.validation.txtSurname;return React.createElement(react_bootstrap_1.Modal.Dialog,{className:"react-modal"},React.createElement(react_bootstrap_1.Modal.Header,{closeButton:!0,onHide:function(){e.handleModalClose()}},React.createElement(react_bootstrap_1.Modal.Title,null,"Data Entry Form (1 of 2)")),React.createElement(react_bootstrap_1.Modal.Body,null,React.createElement(react_bootstrap_1.Form,{autoComplete:"off"},React.createElement(react_bootstrap_1.Panel,null,React.createElement(react_bootstrap_1.Panel.Heading,null,React.createElement(react_bootstrap_1.Panel.Title,null,"About Traveler")),React.createElement(react_bootstrap_1.Panel.Body,null,React.createElement(react_bootstrap_1.FormGroup,{controlId:"txtName",validationState:t.status},React.createElement(react_bootstrap_1.ControlLabel,null,"Name"),React.createElement(react_bootstrap_1.FormControl,{type:"text",placeholder:"Enter traveler Name",value:this.state.traveler.name,onChange:this.handleChange}),t.helpMsg&&React.createElement(react_bootstrap_1.FormControl.Feedback,null),t.helpMsg&&React.createElement(react_bootstrap_1.HelpBlock,null,t.helpMsg)),React.createElement(react_bootstrap_1.FormGroup,{controlId:"txtSurname",validationState:a.status},React.createElement(react_bootstrap_1.ControlLabel,null,"Surname"),React.createElement(react_bootstrap_1.FormControl,{type:"text",placeholder:"Enter traveler Surame",value:this.state.traveler.surname,onChange:this.handleChange}),a.isValid&&React.createElement(react_bootstrap_1.FormControl.Feedback,null),a.isValid&&a.helpMsg&&React.createElement(react_bootstrap_1.HelpBlock,null,t.helpMsg)),React.createElement(react_bootstrap_1.FormGroup,{controlId:"selAgeCode"},React.createElement(react_bootstrap_1.ControlLabel,null,"Passenger Type (Code)"),React.createElement(react_bootstrap_1.FormControl,{componentClass:"select",placeholder:"select",value:this.state.traveler.typeCode,onChange:this.handleChange},React.createElement("option",{value:"select"},"select"),React.createElement("option",{value:"ADT"},"Adult"),React.createElement("option",{value:"CNN"},"Child"),React.createElement("option",{value:"INF"},"Infant"))))))),React.createElement(react_bootstrap_1.Modal.Footer,null,React.createElement(react_bootstrap_1.Button,{onClick:this.handleModalClose,className:"btn btn-secondary"},"Cancel"),React.createElement(react_bootstrap_1.Button,{className:"btn btn-primary",onClick:this.goNext},"Next")));case 2:return React.createElement(react_bootstrap_1.Modal.Dialog,{className:"react-modal"},React.createElement(react_bootstrap_1.Modal.Header,{closeButton:!0,onHide:function(){e.handleModalClose()}},React.createElement(react_bootstrap_1.Modal.Title,null,"Data Entry Form (2 of 2)")),React.createElement(react_bootstrap_1.Modal.Body,null,React.createElement(react_bootstrap_1.Form,null,React.createElement(react_bootstrap_1.Panel,null,React.createElement(react_bootstrap_1.Panel.Heading,null,React.createElement(react_bootstrap_1.Panel.Title,null,"About Travel")),React.createElement(react_bootstrap_1.Panel.Body,null,React.createElement(react_bootstrap_1.FormGroup,{controlId:"selTravelType"},React.createElement(react_bootstrap_1.ControlLabel,null,"Travel Type"),React.createElement(react_bootstrap_1.FormControl,{componentClass:"select",placeholder:"select",onChange:this.handleChange,value:this.state.travelType},React.createElement("option",{value:"select"},"select"),React.createElement("option",{value:"business"},"business"),React.createElement("option",{value:"leisure"},"leisure"))),"business"===this.state.travelType&&React.createElement(react_bootstrap_1.FormGroup,null,React.createElement(react_bootstrap_1.ControlLabel,null,"Add Corporate ID ?"),React.createElement(react_bootstrap_1.InputGroup,null,React.createElement(react_bootstrap_1.InputGroup.Addon,null,React.createElement("input",{type:"checkbox","aria-label":"..."})),React.createElement(react_bootstrap_1.FormControl,{type:"text"}))),"leisure"===this.state.travelType&&React.createElement(react_bootstrap_1.FormGroup,null,React.createElement(react_bootstrap_1.ControlLabel,null,"Add Special Service Request ?"),React.createElement(react_bootstrap_1.InputGroup,null,React.createElement(react_bootstrap_1.InputGroup.Addon,null,React.createElement("input",{type:"checkbox","aria-label":"..."})),React.createElement(react_bootstrap_1.FormControl,{type:"text"}))))))),React.createElement(react_bootstrap_1.Modal.Footer,null,React.createElement(react_bootstrap_1.Button,{onClick:this.handleModalClose,className:"btn btn-secondary"},"Cancel"),React.createElement(react_bootstrap_1.Button,{className:"btn btn-primary",onClick:this.goBack},"Back"),React.createElement(react_bootstrap_1.Button,{className:"btn btn-primary btn-success",onClick:this.executeService},"Create PNR")));case 3:return React.createElement(react_bootstrap_1.Alert,{bsStyle:"success",onDismiss:this.closeAndRefresh},React.createElement("h4",null,"Success"),React.createElement("hr",null),React.createElement("p",null,"Operation completed sucessfully, data was written to the PNR, session status will be refreshed..."),React.createElement("hr",null),React.createElement("p",null,React.createElement(react_bootstrap_1.Button,{bsStyle:"success",onClick:this.closeAndRefresh},"Close")));case 4:return React.createElement(react_bootstrap_1.Alert,{bsStyle:"danger",onDismiss:this.handleModalClose},React.createElement("h4",null,"Error"),React.createElement("hr",null),React.createElement("p",null,"The operation could not be completed, validate records and try again..."),React.createElement("hr",null),React.createElement("p",null,React.createElement(react_bootstrap_1.Button,{bsStyle:"danger",onClick:this.goBack},"Retry"),React.createElement(react_bootstrap_1.Button,{onClick:this.handleModalClose},"Cancel")))}},CreatePNR}(React.Component);exports.CreatePNR=CreatePNR;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jb2RlL0NyZWF0ZVBOUi50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Im9iQUFBLElBQUEsTUFBQSxRQUFBLFNBQ0Esa0JBQUEsUUFBQSxtQkFDQSxVQUFBLFFBQUEsYUFDQSxlQUFBLFFBQUEsd0NBQ0Esa0JBQUEsUUFBQSxzREFDQSxtQkFBQSxRQUFBLG9EQXFDQSxVQUFBLFNBQUEsR0FFSSxTQUFBLFVBQVksR0FBWixJQUFBLEVBQ0ksRUFBQSxLQUFBLEtBQU0sSUFBRSxZQUdSLEVBQUssYUFBZSxFQUFLLGFBQWEsS0FBSyxHQUMzQyxFQUFLLGVBQWlCLEVBQUssZUFBZSxLQUFLLEdBQy9DLEVBQUssZ0JBQWtCLEVBQUssZ0JBQWdCLEtBQUssR0FDakQsRUFBSyxPQUFTLEVBQUssT0FBTyxLQUFLLEdBQy9CLEVBQUssT0FBUyxFQUFLLE9BQU8sS0FBSyxHQUcvQixFQUFLLE1BQVEsQ0FDVCxNQUFNLEVBQ04sU0FBUyxDQUNMLEtBQUssR0FDTCxRQUFRLEdBQ1IsU0FBUyxPQUdiLFdBQVcsQ0FDUCxRQUFRLENBQUMsU0FBUSxFQUFNLE9BQU8sS0FBSyxRQUFRLE1BQzNDLFdBQVcsQ0FBQyxTQUFRLEVBQU0sT0FBTyxLQUFLLFFBQVEsTUFDOUMsU0FBUyxDQUFDLFNBQVEsRUFBTSxPQUFPLEtBQUssUUFBUSxVQTRSNUQsT0FwVCtCLFVBQUEsVUFBQSxHQWdDM0IsVUFBQSxVQUFBLGFBQUEsU0FBYSxHQUVULElBQU0sRUFBUSxFQUFFLE9BQU8sR0FDakIsRUFBVyxFQUFFLE9BQU8sTUFDcEIsRUFBa0IsS0FBSyxNQUFNLFdBRTdCLEVBQWMsS0FBSyxNQUFNLFNBQzNCLEVBQWdCLEtBQUssTUFBTSxXQUkvQixHQUZBLFFBQVEsSUFBSSxlQUFlLEVBQU0sR0FFdEIsWUFBUixHQUE2QixlQUFSLEVBQXFCLENBQ3pDLElBQU0sRUFBZ0IsRUFBZ0IsR0FFaEMsRUFBUyxFQUFTLE9BQ2IsWUFBUixJQUNDLEVBQVksS0FBTyxHQUNaLGVBQVIsSUFDQyxF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TSxRQUN4RCxNQUFBLGNBQUMsa0JBQUEsT0FBTSxDQUFDLFVBQVUsOEJBQThCLFFBQVMsS0FBSyxnQkFBYyxnQkFLcEYsS0FBSyxFQUNGLE9BQ0MsTUFBQSxjQUFDLGtCQUFBLE1BQUssQ0FBQyxRQUFRLFVBQVUsVUFBVyxLQUFLLGlCQUNyQyxNQUFBLGNBQUEsS0FBQSxLQUFBLFdBQ0EsTUFBQSxjQUFBLEtBQUEsTUFDQSxNQUFBLGNBQUEsSUFBQSxLQUFBLHFHQUNBLE1BQUEsY0FBQSxLQUFBLE1BQ0EsTUFBQSxjQUFBLElBQUEsS0FDSSxNQUFBLGNBQUMsa0JBQUEsT0FBTSxDQUFDLFFBQVEsVUFBVSxRQUFTLEtBQUssaUJBQWUsV0FJbkUsS0FBSyxFQUNELE9BQ0EsTUFBQSxjQUFDLGtCQUFBLE1BQUssQ0FBQyxRQUFRLFNBQVMsVUFBVyxLQUFLLGtCQUNwQyxNQUFBLGNBQUEsS0FBQSxLQUFBLFNBQ0EsTUFBQSxjQUFBLEtBQUEsTUFDQSxNQUFBLGNBQUEsSUFBQSxLQUFBLDJFQUdBLE1BQUEsY0FBQSxLQUFBLE1BQ0EsTUFBQSxjQUFBLElBQUEsS0FDSSxNQUFBLGNBQUMsa0JBQUEsT0FBTSxDQUFDLFFBQVEsU0FBUyxRQUFTLEtBQUssUUFBTSxTQUM3QyxNQUFBLGNBQUMsa0JBQUEsT0FBTSxDQUFDLFFBQVMsS0FBSyxrQkFBZ0IsY0FTMUQsVUFwVEEsQ0FBK0IsTUFBTSxXQUF4QixRQUFBLFVBQUEiLCJmaWxlIjoiQ3JlYXRlUE5SLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSBcInJlYWN0XCI7XHJcbmltcG9ydCB7QnV0dG9uLCBGb3JtLCBGb3JtR3JvdXAsIE1vZGFsLCBJbnB1dEdyb3VwLCBDb250cm9sTGFiZWwsIEZvcm1Db250cm9sLCBIZWxwQmxvY2ssIFBhbmVsLCBBbGVydH0gZnJvbSBcInJlYWN0LWJvb3RzdHJhcFwiO1xyXG5pbXBvcnQgeyBnZXRTZXJ2aWNlLCB0IH0gZnJvbSBcIi4vQ29udGV4dFwiO1xyXG5pbXBvcnQgeyBMYXllclNlcnZpY2UgfSBmcm9tIFwic2FicmUtbmd2LWNvcmUvc2VydmljZXMvTGF5ZXJTZXJ2aWNlXCI7XHJcbmltcG9ydCB7SVNvYXBBcGlTZXJ2aWNlfSBmcm9tIFwic2FicmUtbmd2LWNvbW11bmljYXRpb24vaW50ZXJmYWNlcy9JU29hcEFwaVNlcnZpY2VcIjtcclxuaW1wb3J0IHsgUG5yUHVibGljU2VydmljZSB9IGZyb20gXCJzYWJyZS1uZ3YtYXBwL2FwcC9zZXJ2aWNlcy9pbXBsL1BuclB1YmxpY1NlcnZpY2VcIjtcclxuXHJcbi8qXHJcbkRlZmluZSBpbnRlcmZhY2UgZm9yIGhhbmRsaW5nIFRyYXZlbGVyIGRldGFpbHMgb24gdGhlIFJlYWN0IGNvbXBvbmVudCBzdGF0ZVxyXG4qL1xyXG5leHBvcnQgaW50ZXJmYWNlIFRyYXZlbGVyIHtcclxuICAgIG5hbWU6c3RyaW5nLFxyXG4gICAgc3VybmFtZTpzdHJpbmcsXHJcbiAgICBlbWFpbD86c3RyaW5nLFxyXG4gICAgdHlwZUNvZGU/OidBRFQnIHwgJ0lORicgfCAnQ05OJywgICAgXHJcbn1cclxuXHJcbi8qXHJcbkRlZmluZSBpbnRlcmZhY2UgZm9yIGhhbmRsaW5nIGZpZWxkIHZhbGlkYXRpb24gb24gdGhlIFJlYWN0IGNvbXBvbmVudCBzdGF0ZVxyXG4qL1xyXG5leHBvcnQgaW50ZXJmYWNlIEZpZWxkVmFsaWRhdGlvbiB7XHJcbiAgICBbZmllbGRJZDpzdHJpbmddOntcclxuICAgICAgICBpc1ZhbGlkOmJvb2xlYW4sXHJcbiAgICAgICAgc3RhdHVzOlwiZXJyb3JcInxcIndhcm5pbmdcInxcInN1Y2Nlc3NcInxudWxsLFxyXG4gICAgICAgIGhlbHBNc2c/OnN0cmluZyAgXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qXHJcblJlYWN0IGNvbXBvbmVudCBzdGF0ZSBpbnRlcmZhY2UsIGhvbGRzIGFsbCBkYXRhIGhhbmRsZWQgYnkgdGhlIEZvcm1cclxuKi9cclxuZXhwb3J0IGludGVyZmFjZSBteVN0YXRlIHtcclxuICAgIHN0YWdlOm51bWJlcixcclxuICAgIHRyYXZlbGVyPzpUcmF2ZWxlcixcclxuICAgIHRyYXZlbFR5cGU/OnN0cmluZyxcclxuICAgIHRyYXZlbEluZm8/OkFycmF5PHN0cmluZz4sXHJcbiAgICB2YWxpZGF0aW9uPzpGaWVsZFZhbGlkYXRpb25cclxufVxyXG5cclxuLypcclxuQ3JlYXRlUE5SIENvbXBvbmVudCwgbXVsdGktc3RhZ2UgZGF0YSBlbnRyeSBmb3JtIGJhc2VkIG9uIHJlYWN0LWJvb3RzdHJhcCBjb21wb25lbnQgbGlicmFyeVxyXG4qL1xyXG5leHBvcnQgY2xhc3MgQ3JlYXRlUE5SIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PHt9LG15U3RhdGU+e1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGUpe1xyXG4gICAgICAgIHN1cGVyKGUpO1xyXG5cclxuICAgICAgICAvL2JpbmQgZXZlbnQgaGFuZGxlcnMgdG8gdGhlIGNvbXBvbmVudCBpbnN0YW5jZVxyXG4gICAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlID0gdGhpcy5oYW5kbGVDaGFuZ2UuYmluZCh0aGlzKTtcclxuICAgICAgICB0aGlzLmV4ZWN1dGVTZXJ2aWNlID0gdGhpcy5leGVjdXRlU2VydmljZS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIHRoaXMuY2xvc2VBbmRSZWZyZXNoID0gdGhpcy5jbG9zZUFuZFJlZnJlc2guYmluZCh0aGlzKTtcclxuICAgICAgICB0aGlzLmdvQmFjayA9IHRoaXMuZ29CYWNrLmJpbmQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5nb05leHQgPSB0aGlzLmdvTmV4dC5iaW5kKHRoaXMpO1xyXG5cclxuICAgICAgICAvL2ZpbGwgZGVmYXVsdCBzdGF0ZSB2YWx1ZXMgZHVyaW5nIGNvbXBvbmVudCBpbml0aWFsaXphdGlvblxyXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XHJcbiAgICAgICAgICAgIHN0YWdlOjEsXHJcbiAgICAgICAgICAgIHRyYXZlbGVyOntcclxuICAgICAgICAgICAgICAgIG5hbWU6XCJcIixcclxuICAgICAgICAgICAgICAgIHN1cm5hbWU6XCJcIixcclxuICAgICAgICAgICAgICAgIHR5cGVDb2RlOlwiQURUXCJcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB2YWxpZGF0aW9uOntcclxuICAgICAgICAgICAgICAgIHR4dE5hbWU6e2lzVmFsaWQ6ZmFsc2Usc3RhdHVzOm51bGwsaGVscE1zZzpudWxsfSxcclxuICAgICAgICAgICAgICAgIHR4dFN1cm5hbWU6e2lzVmFsaWQ6ZmFsc2Usc3RhdHVzOm51bGwsaGVscE1zZzpudWxsfSxcclxuICAgICAgICAgICAgICAgIHR4dEVtYWlsOntpc1ZhbGlkOmZhbHNlLHN0YXR1czpudWxsLGhlbHBNc2c6bnVsbH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKlxyXG4gICAgTWV0aG9kIHRvIGhhbmRsZSBmaWVsZCBjaGFuZ2VzLCBwZXJmb3JtIHZhbGlkYXRpb24gYW5kIHVwZGF0ZSBzdGF0ZVxyXG4gICAgKi9cclxuICAgIGhhbmRsZUNoYW5nZShlKXtcclxuXHJcbiAgICAgICAgY29uc3QgY3RsSWQgPSBlLnRhcmdldC5pZDtcclxuICAgICAgICBjb25zdCBmbGRWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25TdGF0ZSA9IHRoaXMuc3RhdGUudmFsaWRhdGlvbjtcclxuXHJcbiAgICAgICAgY29uc3QgdG1wVHJhdmVsZXIgPSB0aGlzLnN0YXRlLnRyYXZlbGVyO1xyXG4gICAgICAgIGxldCB0bXBUcmF2ZWxUeXBlID0gdGhpcy5zdGF0ZS50cmF2ZWxUeXBlO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhcImhhbmRsZUNoYW5nZVwiLGN0bElkLGZsZFZhbHVlKTtcclxuXHJcbiAgICAgICAgaWYoY3RsSWQ9PT1cInR4dE5hbWVcIiB8fCBjdGxJZD09PVwidHh0U3VybmFtZVwiKXtcclxuICAgICAgICAgICAgY29uc3QgdG1wVmFsaWRhdGlvbiA9IHZhbGlkYXRpb25TdGF0ZVtjdGxJZF1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IGZsZFZhbHVlLmxlbmd0aDtcclxuICAgICAgICAgICAgaWYoY3RsSWQ9PT1cInR4dE5hbWVcIilcclxuICAgICAgICAgICAgICAgIHRtcFRyYXZlbGVyLm5hbWUgPSBmbGRWYWx1ZTtcclxuICAgICAgICAgICAgaWYoY3RsSWQ9PT1cInR4dFN1cm5hbWVcIilcclxuICAgICAgICAgICAgICAgIHRtcFRyYXZlbGVyLnN1cm5hbWUgPSBmbGRWYWx1ZTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKGxlbmd0aDw9MCl7XHJcbiAgICAgICAgICAgICAgICB0bXBWYWxpZGF0aW9uLmlzVmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRtcFZhbGlkYXRpb24uc3RhdHVzID0gJ2Vycm9yJztcclxuICAgICAgICAgICAgICAgIHRtcFZhbGlkYXRpb24uaGVscE1zZyA9IFwicmVxdWlyZWQgZmllbGRcIjtcclxuICAgICAgICAgICAgfWVsc2UgaWYobGVuZ3RoPD0xKXtcclxuICAgICAgICAgICAgICAgIHRtcFZhbGlkYXRpb24uaXNWYWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdG1wVmFsaWRhdGlvbi5zdGF0dXMgPSAnd2FybmluZyc7XHJcbiAgICAgICAgICAgICAgICB0bXBWYWxpZGF0aW9uLmhlbHBNc2cgPSBcIm11c3QgYmUgbW9yZSB0aGFuIG9uZSBjaGFyYWN0ZXIgbG9uZ1wiO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihsZW5ndGg+MSl7XHJcbiAgICAgICAgICAgICAgICB0bXBWYWxpZGF0aW9uLmlzVmFsaWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdG1wVmFsaWRhdGlvbi5zdGF0dXMgPSAnc3VjY2Vzcyc7XHJcbiAgICAgICAgICAgICAgICB0bXBWYWxpZGF0aW9uLmhlbHBNc2cgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoY3RsSWQ9PT1cInNlbEFnZUNvZGVcIil7XHJcbiAgICAgICAgICAgIHRtcFRyYXZlbGVyLnR5cGVDb2RlID0gZmxkVmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZihjdGxJZD09PVwic2VsVHJhdmVsVHlwZVwiKXtcclxuICAgICAgICAgICAgdG1wVHJhdmVsVHlwZSA9IGZsZFZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZShcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHJhdmVsZXI6dG1wVHJhdmVsZXIsXHJcbiAgICAgICAgICAgICAgICB0cmF2ZWxUeXBlOnRtcFRyYXZlbFR5cGUsXHJcbiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uOnZhbGlkYXRpb25TdGF0ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvL21vdmVzIHRvIHRoZSBuZXh0IHN0YWdlXHJcbiAgICBnb05leHQoZXZ0KXtcclxuICAgICAgICBjb25zdCBjdXJyU3RhZ2UgPSB0aGlzLnN0YXRlLnN0YWdlO1xyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe3N0YWdlOmN1cnJTdGFnZSsxfSlcclxuICAgIH1cclxuXHJcbiAgICAvL3Jld2luZCBzdGFnZVxyXG4gICAgZ29CYWNrKGV2dCl7XHJcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7c3RhZ2U6MX0pXHJcbiAgICB9XHJcblxyXG4gICAgLypcclxuICAgIENyZWF0ZXMgYSBVcGRhdGVSZXNlcnZhdGlvblJRIHJlcXVlc3QgcGF5bG9hZCBtZXJnaW5nIHN0YXRlIGRhdGEsIHRoZW4gdXRpbGl6ZXMgXHJcbiAgICBTT0FQIEFQSSBzZXJ2aWNlIGhhbmRsZXIgdG8gc2VuZCB0aGUgcmVxdWVzdCBhbmQgcGFyc2UgcmVzdWx0c1xyXG4gICAgKi9cclxuICAgIGV4ZWN1dGVTZXJ2aWNlKCl7XHJcbiAgICAgICAgY29uc3Qgc29hcEFwaVNlcnZpY2UgPSBnZXRTZXJ2aWNlKElTb2FwQXBpU2VydmljZSk7XHJcbiAgICAgICAgY29uc3QgcGwxID0gYFxyXG4gICAgICAgIDxVcGRhdGVSZXNlcnZhdGlvblJRIFZlcnNpb249XCIxLjE5LjhcIiB4bWxucz1cImh0dHA6Ly93ZWJzZXJ2aWNlcy5zYWJyZS5jb20vcG5yYnVpbGRlci92MV8xOVwiPlxyXG4gICAgICAgIDxSZXF1ZXN0VHlwZSBjb21taXRUcmFuc2FjdGlvbj1cImZhbHNlXCIgaW5pdGlhbElnbm9yZT1cInRydWVcIj5TdGF0ZWZ1bDwvUmVxdWVzdFR5cGU+XHJcbiAgICAgICAgPFJldHVybk9wdGlvbnMgSW5jbHVkZVVwZGF0ZURldGFpbHM9XCJ0cnVlXCIgUmV0cmlldmVQTlI9XCJmYWxzZVwiLz5cclxuICAgICAgICAgICAgPFJlc2VydmF0aW9uVXBkYXRlTGlzdD5cclxuICAgICAgICAgICAgICAgIDxSZXNlcnZhdGlvblVwZGF0ZUl0ZW0+XHJcbiAgICAgICAgICAgICAgICAgICAgPFBhc3Nlbmdlck5hbWVVcGRhdGUgb3A9XCJDXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxUcmF2ZWxlck5hbWUgdHlwZT1cIiR7dGhpcy5zdGF0ZS50cmF2ZWxlci50eXBlQ29kZX1cIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxHaXZlbj4ke3RoaXMuc3RhdGUudHJhdmVsZXIubmFtZX08L0dpdmVuPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFN1cm5hbWU+JHt0aGlzLnN0YXRlLnRyYXZlbGVyLnN1cm5hbWV9PC9TdXJuYW1lPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L1RyYXZlbGVyTmFtZT5cclxuICAgICAgICAgICAgICAgICAgICA8L1Bhc3Nlbmdlck5hbWVVcGRhdGU+XHJcbiAgICAgICAgICAgICAgICA8L1Jlc2VydmF0aW9uVXBkYXRlSXRlbT5cclxuICAgICAgICAgICAgICAgIDxSZXNlcnZhdGlvblVwZGF0ZUl0ZW0+XHJcbiAgICAgICAgICAgICAgICAgICAgPFJlbWFya1VwZGF0ZSBvcD1cIkNcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPFJlbWFya1RleHQ+VEhJUyBJUyAke3RoaXMuc3RhdGUudHJhdmVsVHlwZX0gVFJBVkVMIFRZUEUgUkVNQVJLPC9SZW1hcmtUZXh0PlxyXG4gICAgICAgICAgICAgICAgICAgIDwvUmVtYXJrVXBkYXRlPlxyXG4gICAgICAgICAgICAgICAgPC9SZXNlcnZhdGlvblVwZGF0ZUl0ZW0+XHJcbiAgICAgICAgICAgIDwvUmVzZXJ2YXRpb25VcGRhdGVMaXN0PlxyXG4gICAgICAgIDwvVXBkYXRlUmVzZXJ2YXRpb25SUT5cclxuICAgICAgICBgO1xyXG5cclxuICAgICAgICBzb2FwQXBpU2VydmljZS5jYWxsU3dzKHthY3Rpb246XCJVcGRhdGVSZXNlcnZhdGlvblJRXCIscGF5bG9hZDpwbDEsYXV0aFRva2VuVHlwZTpcIlNFU1NJT05cIn0pXHJcbiAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgIChyZXMpPT57XHJcbiAgICAgICAgICAgICAgICAvL3ZhbGlkYXRlIEFQSSByZXNwb25zZVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTb2FwIEFQSSBjYWxsIHJlc3VsdFwiLEpTT04uc3RyaW5naWZ5KHJlcykpO1xyXG4gICAgICAgICAgICAgICAgaWYocmVzLmVycm9yQ29kZSB8fCAocmVzLnZhbHVlICYmIHJlcy52YWx1ZS5pbmRleE9mKFwiPHN0bDE5OkVycm9yXCIpPj0wKSApe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe3N0YWdlOjR9KVxyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7c3RhZ2U6M30pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICAgICAgLmNhdGNoKFxyXG4gICAgICAgICAgICAoZXJyKT0+e1xyXG4gICAgICAgICAgICAgICAgLy9leGNlcHRpb24gY2FsbGluZyBzb2FwIEFQSVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTb2FwIEFQSSBjYWxsIGVycm9yXCIsZXJyKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe3N0YWdlOjR9KVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgIH1cclxuXHJcbiAgICBoYW5kbGVNb2RhbENsb3NlKCk6IHZvaWQge1xyXG4gICAgICAgIGdldFNlcnZpY2UoTGF5ZXJTZXJ2aWNlKS5jbGVhckxheWVyKDQyKTtcclxuICAgIH1cclxuICAgIC8qXHJcbiAgICBSZWZyZXNoZXMgdGhlIFRyaXAgU3VtbWFyeSBwYW5lbCBhZnRlciBzdWNlc3NmdWxsIFVwZGF0ZVJlc2VydmF0aW9uUlEgcmVzcG9uc2UsIFxyXG4gICAgdGhpcyBtYWtlcyB0aGUgY2hhbmdlcyB3cml0dGVuIG9uIHRoZSBQTlIgdG8gYXBwZWFyIG9uIHRoZSBVSVxyXG4gICAgKi9cclxuICAgIGNsb3NlQW5kUmVmcmVzaCgpe1xyXG4gICAgICAgIGdldFNlcnZpY2UoUG5yUHVibGljU2VydmljZSkucmVmcmVzaERhdGEoKTtcclxuICAgICAgICB0aGlzLmhhbmRsZU1vZGFsQ2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKlxyXG4gICAgUmVuZGVyIHBhcnRzIG9mIG11bHRpLXN0YWdlIGZvcm0gdXNpbmcgcmVhY3QtYm9vdHN0cmFwIGNvbXBvbmVudHNcclxuICAgIFRoZSBkYXRhIGVudHJ5IGZvcm0gaXMgd3JhcHBlZCBieSBhIE1vZGFsIERpYWxvZyBjb21wb25lbnRcclxuICAgICovXHJcbiAgICByZW5kZXIoKTogSlNYLkVsZW1lbnQge1xyXG5cclxuICAgICAgICBzd2l0Y2godGhpcy5zdGF0ZS5zdGFnZSl7XHJcbiAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICBjb25zdCB2YWxpZGF0ZU5hbWUgPSB0aGlzLnN0YXRlLnZhbGlkYXRpb25bXCJ0eHROYW1lXCJdO1xyXG4gICAgICAgICAgICBjb25zdCB2YWxpZGF0ZVN1cm5hbWUgPSB0aGlzLnN0YXRlLnZhbGlkYXRpb25bXCJ0eHRTdXJuYW1lXCJdO1xyXG4gICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICA8TW9kYWwuRGlhbG9nIGNsYXNzTmFtZT1cInJlYWN0LW1vZGFsXCI+XHJcbiAgICAgICAgICAgIDxNb2RhbC5IZWFkZXIgY2xvc2VCdXR0b24gb25IaWRlPXsoKT0+e3RoaXMuaGFuZGxlTW9kYWxDbG9zZSgpO319PlxyXG4gICAgICAgICAgICAgICAgPE1vZGFsLlRpdGxlPkRhdGEgRW50cnkgRm9ybSAoMSBvZiAyKTwvTW9kYWwuVGl0bGU+XHJcbiAgICAgICAgICAgIDwvTW9kYWwuSGVhZGVyPlxyXG4gICAgICAgICAgICA8TW9kYWwuQm9keT5cclxuICAgICAgICAgICAgPEZvcm0gYXV0b0NvbXBsZXRlPVwib2ZmXCI+XHJcbiAgICAgICAgICAgICAgICA8UGFuZWw+XHJcbiAgICAgICAgICAgICAgICAgICAgPFBhbmVsLkhlYWRpbmc+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxQYW5lbC5UaXRsZT5BYm91dCBUcmF2ZWxlcjwvUGFuZWwuVGl0bGU+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9QYW5lbC5IZWFkaW5nPlxyXG4gICAgICAgICAgICAgICAgICAgIDxQYW5lbC5Cb2R5PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8Rm9ybUdyb3VwIGNvbnRyb2xJZD1cInR4dE5hbWVcIiB2YWxpZGF0aW9uU3RhdGU9e3ZhbGlkYXRlTmFtZS5zdGF0dXN9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPENvbnRyb2xMYWJlbD5OYW1lPC9Db250cm9sTGFiZWw+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Rm9ybUNvbnRyb2wgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIkVudGVyIHRyYXZlbGVyIE5hbWVcIiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS50cmF2ZWxlci5uYW1lfSBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5oYW5kbGVDaGFuZ2V9IC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dmFsaWRhdGVOYW1lLmhlbHBNc2cgJiYgPEZvcm1Db250cm9sLkZlZWRiYWNrIC8+fVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyh2YWxpZGF0ZU5hbWUuaGVscE1zZykgJiYgPEhlbHBCbG9jaz57dmFsaWRhdGVOYW1lLmhlbHBNc2d9PC9IZWxwQmxvY2s+fVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L0Zvcm1Hcm91cD5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxGb3JtR3JvdXAgY29udHJvbElkPVwidHh0U3VybmFtZVwiIHZhbGlkYXRpb25TdGF0ZT17dmFsaWRhdGVTdXJuYW1lLnN0YXR1c30+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Q29udHJvbExhYmVsPlN1cm5hbWU8L0NvbnRyb2xMYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxGb3JtQ29udHJvbCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiRW50ZXIgdHJhdmVsZXIgU3VyYW1lXCIgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUudHJhdmVsZXIuc3VybmFtZX0gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuaGFuZGxlQ2hhbmdlfSAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge3ZhbGlkYXRlU3VybmFtZS5pc1ZhbGlkICYmIDxGb3JtQ29udHJvbC5GZWVkYmFjayAvPn1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsodmFsaWRhdGVTdXJuYW1lLmlzVmFsaWQgJiYgdmFsaWRhdGVTdXJuYW1lLmhlbHBNc2cpICYmIDxIZWxwQmxvY2s+e3ZhbGlkYXRlTmFtZS5oZWxwTXNnfTwvSGVscEJsb2NrPn1cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9Gb3JtR3JvdXA+XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8Rm9ybUdyb3VwIGNvbnRyb2xJZD1cInNlbEFnZUNvZGVcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDb250cm9sTGFiZWw+UGFzc2VuZ2VyIFR5cGUgKENvZGUpPC9Db250cm9sTGFiZWw+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Rm9ybUNvbnRyb2wgY29tcG9uZW50Q2xhc3M9XCJzZWxlY3RcIiBwbGFjZWhvbGRlcj1cInNlbGVjdFwiIHZhbHVlPXt0aGlzLnN0YXRlLnRyYXZlbGVyLnR5cGVDb2RlfSBvbkNoYW5nZT17dGhpcy5oYW5kbGVDaGFuZ2V9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJzZWxlY3RcIj5zZWxlY3Q8L29wdGlvbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiQURUXCI+QWR1bHQ8L29wdGlvbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiQ05OXCI+Q2hpbGQ8L29wdGlvbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiSU5GXCI+SW5mYW50PC9vcHRpb24+XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Gb3JtQ29udHJvbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9Gb3JtR3JvdXA+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9QYW5lbC5Cb2R5PlxyXG4gICAgICAgICAgICAgICAgPC9QYW5lbD5cclxuICAgICAgICAgICAgPC9Gb3JtPlxyXG4gICAgICAgICAgICA8L01vZGFsLkJvZHk+XHJcbiAgICAgICAgICAgIDxNb2RhbC5Gb290ZXI+XHJcbiAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e3RoaXMuaGFuZGxlTW9kYWxDbG9zZX0gY2xhc3NOYW1lPVwiYnRuIGJ0bi1zZWNvbmRhcnlcIj5DYW5jZWw8L0J1dHRvbj5cclxuICAgICAgICAgICAgICAgIDxCdXR0b24gY2xhc3NOYW1lPVwiYnRuIGJ0bi1wcmltYXJ5XCIgb25DbGljaz17dGhpcy5nb05leHR9Pk5leHQ8L0J1dHRvbj5cclxuICAgICAgICAgICAgPC9Nb2RhbC5Gb290ZXI+XHJcbiAgICAgICAgICAgIDwvTW9kYWwuRGlhbG9nPlxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPE1vZGFsLkRpYWxvZyBjbGFzc05hbWU9XCJyZWFjdC1tb2RhbFwiPlxyXG4gICAgICAgICAgICA8TW9kYWwuSGVhZGVyIGNsb3NlQnV0dG9uIG9uSGlkZT17KCk9Pnt0aGlzLmhhbmRsZU1vZGFsQ2xvc2UoKTt9fT5cclxuICAgICAgICAgICAgICAgIDxNb2RhbC5UaXRsZT5EYXRhIEVudHJ5IEZvcm0gKDIgb2YgMik8L01vZGFsLlRpdGxlPlxyXG4gICAgICAgICAgICA8L01vZGFsLkhlYWRlcj5cclxuICAgICAgICAgICAgPE1vZGFsLkJvZHk+XHJcbiAgICAgICAgICAgIDxGb3JtPlxyXG4gICAgICAgICAgICAgICAgPFBhbmVsPlxyXG4gICAgICAgICAgICAgICAgICAgIDxQYW5lbC5IZWFkaW5nPjxQYW5lbC5UaXRsZT5BYm91dCBUcmF2ZWw8L1BhbmVsLlRpdGxlPjwvUGFuZWwuSGVhZGluZz5cclxuICAgICAgICAgICAgICAgICAgICA8UGFuZWwuQm9keT5cclxuICAgICAgICAgICAgICAgIDxGb3JtR3JvdXAgY29udHJvbElkPVwic2VsVHJhdmVsVHlwZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgIDxDb250cm9sTGFiZWw+VHJhdmVsIFR5cGU8L0NvbnRyb2xMYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICA8Rm9ybUNvbnRyb2wgY29tcG9uZW50Q2xhc3M9XCJzZWxlY3RcIiBwbGFjZWhvbGRlcj1cInNlbGVjdFwiIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX0gdmFsdWU9e3RoaXMuc3RhdGUudHJhdmVsVHlwZX0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJzZWxlY3RcIj5zZWxlY3Q8L29wdGlvbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImJ1c2luZXNzXCI+YnVzaW5lc3M8L29wdGlvbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImxlaXN1cmVcIj5sZWlzdXJlPC9vcHRpb24+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9Gb3JtQ29udHJvbD5cclxuICAgICAgICAgICAgICAgICAgICA8L0Zvcm1Hcm91cD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgeyB0aGlzLnN0YXRlLnRyYXZlbFR5cGU9PT1cImJ1c2luZXNzXCIgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgPEZvcm1Hcm91cD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDb250cm9sTGFiZWw+QWRkIENvcnBvcmF0ZSBJRCA/PC9Db250cm9sTGFiZWw+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SW5wdXRHcm91cD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxJbnB1dEdyb3VwLkFkZG9uPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBhcmlhLWxhYmVsPVwiLi4uXCIgLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvSW5wdXRHcm91cC5BZGRvbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxGb3JtQ29udHJvbCB0eXBlPVwidGV4dFwiIC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0lucHV0R3JvdXA+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvRm9ybUdyb3VwPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdGhpcy5zdGF0ZS50cmF2ZWxUeXBlPT09XCJsZWlzdXJlXCIgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgPEZvcm1Hcm91cD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDb250cm9sTGFiZWw+QWRkIFNwZWNpYWwgU2VydmljZSBSZXF1ZXN0ID88L0NvbnRyb2xMYWJlbD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxJbnB1dEdyb3VwPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPElucHV0R3JvdXAuQWRkb24+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIGFyaWEtbGFiZWw9XCIuLi5cIiAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9JbnB1dEdyb3VwLkFkZG9uPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEZvcm1Db250cm9sIHR5cGU9XCJ0ZXh0XCIgLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvSW5wdXRHcm91cD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9Gb3JtR3JvdXA+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICA8L1BhbmVsLkJvZHk+XHJcbiAgICAgICAgICAgICAgICA8L1BhbmVsPlxyXG5cclxuICAgICAgICAgICAgPC9Gb3JtPlxyXG4gICAgICAgICAgICA8L01vZGFsLkJvZHk+XHJcbiAgICAgICAgICAgIDxNb2RhbC5Gb290ZXI+XHJcbiAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e3RoaXMuaGFuZGxlTW9kYWxDbG9zZX0gY2xhc3NOYW1lPVwiYnRuIGJ0bi1zZWNvbmRhcnlcIj5DYW5jZWw8L0J1dHRvbj5cclxuICAgICAgICAgICAgICAgIDxCdXR0b24gY2xhc3NOYW1lPVwiYnRuIGJ0bi1wcmltYXJ5XCIgb25DbGljaz17dGhpcy5nb0JhY2t9PkJhY2s8L0J1dHRvbj5cclxuICAgICAgICAgICAgICAgIDxCdXR0b24gY2xhc3NOYW1lPVwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi1zdWNjZXNzXCIgb25DbGljaz17dGhpcy5leGVjdXRlU2VydmljZX0+Q3JlYXRlIFBOUjwvQnV0dG9uPlxyXG5cclxuICAgICAgICAgICAgPC9Nb2RhbC5Gb290ZXI+XHJcbiAgICAgICAgICAgIDwvTW9kYWwuRGlhbG9nPlxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICByZXR1cm4oXHJcbiAgICAgICAgICAgIDxBbGVydCBic1N0eWxlPVwic3VjY2Vzc1wiIG9uRGlzbWlzcz17dGhpcy5jbG9zZUFuZFJlZnJlc2h9PlxyXG4gICAgICAgICAgICAgICAgPGg0PlN1Y2Nlc3M8L2g0PlxyXG4gICAgICAgICAgICAgICAgPGhyLz5cclxuICAgICAgICAgICAgICAgIDxwPk9wZXJhdGlvbiBjb21wbGV0ZWQgc3VjZXNzZnVsbHksIGRhdGEgd2FzIHdyaXR0ZW4gdG8gdGhlIFBOUiwgc2Vzc2lvbiBzdGF0dXMgd2lsbCBiZSByZWZyZXNoZWQuLi48L3A+XHJcbiAgICAgICAgICAgICAgICA8aHIvPlxyXG4gICAgICAgICAgICAgICAgPHA+XHJcbiAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiBic1N0eWxlPVwic3VjY2Vzc1wiIG9uQ2xpY2s9e3RoaXMuY2xvc2VBbmRSZWZyZXNofT5DbG9zZTwvQnV0dG9uPlxyXG4gICAgICAgICAgICAgICAgPC9wPlxyXG4gICAgICAgICAgICA8L0FsZXJ0PlxyXG4gICAgICAgICAgICk7XHJcbiAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICByZXR1cm4oXHJcbiAgICAgICAgICAgIDxBbGVydCBic1N0eWxlPVwiZGFuZ2VyXCIgb25EaXNtaXNzPXt0aGlzLmhhbmRsZU1vZGFsQ2xvc2V9PlxyXG4gICAgICAgICAgICAgICAgPGg0PkVycm9yPC9oND5cclxuICAgICAgICAgICAgICAgIDxoci8+XHJcbiAgICAgICAgICAgICAgICA8cD5cclxuICAgICAgICAgICAgICAgICAgICBUaGUgb3BlcmF0aW9uIGNvdWxkIG5vdCBiZSBjb21wbGV0ZWQsIHZhbGlkYXRlIHJlY29yZHMgYW5kIHRyeSBhZ2Fpbi4uLlxyXG4gICAgICAgICAgICAgICAgPC9wPlxyXG4gICAgICAgICAgICAgICAgPGhyLz5cclxuICAgICAgICAgICAgICAgIDxwPlxyXG4gICAgICAgICAgICAgICAgICAgIDxCdXR0b24gYnNTdHlsZT1cImRhbmdlclwiIG9uQ2xpY2s9e3RoaXMuZ29CYWNrfT5SZXRyeTwvQnV0dG9uPlxyXG4gICAgICAgICAgICAgICAgICAgIDxCdXR0b24gb25DbGljaz17dGhpcy5oYW5kbGVNb2RhbENsb3NlfT5DYW5jZWw8L0J1dHRvbj5cclxuICAgICAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgICAgPC9BbGVydD5cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH1cclxuXHJcbn0iXSwic291cmNlUm9vdCI6IiJ9 